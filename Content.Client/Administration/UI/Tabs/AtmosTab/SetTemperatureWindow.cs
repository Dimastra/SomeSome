using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using CompiledRobustXaml;
using Robust.Client.AutoGenerated;
using Robust.Client.Console;
using Robust.Client.Player;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.CustomControls;
using Robust.Shared.Console;
using Robust.Shared.GameObjects;
using Robust.Shared.IoC;
using Robust.Shared.Map;
using Robust.Shared.Map.Components;
using Robust.Shared.Maths;

namespace Content.Client.Administration.UI.Tabs.AtmosTab
{
	// Token: 0x020004A5 RID: 1189
	[GenerateTypedNameReferences]
	public sealed class SetTemperatureWindow : DefaultWindow
	{
		// Token: 0x06001D44 RID: 7492 RVA: 0x000AAB14 File Offset: 0x000A8D14
		protected override void EnteredTree()
		{
			this._data = from g in IoCManager.Resolve<IMapManager>().GetAllGrids()
			where (int)g.Owner != 0
			select g;
			foreach (MapGridComponent mapGridComponent in this._data)
			{
				LocalPlayer localPlayer = IoCManager.Resolve<IPlayerManager>().LocalPlayer;
				EntityUid? entityUid = (localPlayer != null) ? localPlayer.ControlledEntity : null;
				TransformComponent componentOrNull = EntityManagerExt.GetComponentOrNull<TransformComponent>(IoCManager.Resolve<IEntityManager>(), entityUid);
				EntityUid? entityUid2 = (componentOrNull != null) ? componentOrNull.GridUid : null;
				OptionButton gridOptions = this.GridOptions;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(1, 2);
				defaultInterpolatedStringHandler.AppendFormatted<EntityUid>(mapGridComponent.Owner);
				defaultInterpolatedStringHandler.AppendLiteral(" ");
				EntityUid? entityUid3 = entityUid2;
				EntityUid owner = mapGridComponent.Owner;
				defaultInterpolatedStringHandler.AppendFormatted((entityUid3 != null && (entityUid3 == null || entityUid3.GetValueOrDefault() == owner)) ? " (Current)" : "");
				gridOptions.AddItem(defaultInterpolatedStringHandler.ToStringAndClear(), null);
			}
			this.GridOptions.OnItemSelected += delegate(OptionButton.ItemSelectedEventArgs eventArgs)
			{
				this.GridOptions.SelectId(eventArgs.Id);
			};
			this.SubmitButton.OnPressed += this.SubmitButtonOnOnPressed;
		}

		// Token: 0x06001D45 RID: 7493 RVA: 0x000AAC88 File Offset: 0x000A8E88
		[NullableContext(1)]
		private void SubmitButtonOnOnPressed(BaseButton.ButtonEventArgs obj)
		{
			if (this._data == null)
			{
				return;
			}
			EntityUid owner = this._data.ToList<MapGridComponent>()[this.GridOptions.SelectedId].Owner;
			IConsoleHost consoleHost = IoCManager.Resolve<IClientConsoleHost>();
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(11, 4);
			defaultInterpolatedStringHandler.AppendLiteral("settemp ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(this.TileXSpin.Value);
			defaultInterpolatedStringHandler.AppendLiteral(" ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(this.TileYSpin.Value);
			defaultInterpolatedStringHandler.AppendLiteral(" ");
			defaultInterpolatedStringHandler.AppendFormatted<EntityUid>(owner);
			defaultInterpolatedStringHandler.AppendLiteral(" ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(this.TemperatureSpin.Value);
			consoleHost.ExecuteCommand(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x17000618 RID: 1560
		// (get) Token: 0x06001D46 RID: 7494 RVA: 0x000A9602 File Offset: 0x000A7802
		private OptionButton GridOptions
		{
			get
			{
				return base.FindControl<OptionButton>("GridOptions");
			}
		}

		// Token: 0x17000619 RID: 1561
		// (get) Token: 0x06001D47 RID: 7495 RVA: 0x000A9B6D File Offset: 0x000A7D6D
		private SpinBox TileXSpin
		{
			get
			{
				return base.FindControl<SpinBox>("TileXSpin");
			}
		}

		// Token: 0x1700061A RID: 1562
		// (get) Token: 0x06001D48 RID: 7496 RVA: 0x000A9B7A File Offset: 0x000A7D7A
		private SpinBox TileYSpin
		{
			get
			{
				return base.FindControl<SpinBox>("TileYSpin");
			}
		}

		// Token: 0x1700061B RID: 1563
		// (get) Token: 0x06001D49 RID: 7497 RVA: 0x000AAD48 File Offset: 0x000A8F48
		private SpinBox TemperatureSpin
		{
			get
			{
				return base.FindControl<SpinBox>("TemperatureSpin");
			}
		}

		// Token: 0x1700061C RID: 1564
		// (get) Token: 0x06001D4A RID: 7498 RVA: 0x00091514 File Offset: 0x0008F714
		private Button SubmitButton
		{
			get
			{
				return base.FindControl<Button>("SubmitButton");
			}
		}

		// Token: 0x06001D4B RID: 7499 RVA: 0x000AAD55 File Offset: 0x000A8F55
		public SetTemperatureWindow()
		{
			SetTemperatureWindow.!XamlIlPopulateTrampoline(this);
		}

		// Token: 0x06001D4D RID: 7501 RVA: 0x000AAD78 File Offset: 0x000A8F78
		static void xaml(IServiceProvider A_0, DefaultWindow A_1)
		{
			XamlIlContext.Context<DefaultWindow> context = new XamlIlContext.Context<DefaultWindow>(A_0, null, "resm:Content.Client.Administration.UI.Tabs.AtmosTab.SetTemperatureWindow.xaml?assembly=Content.Client");
			context.RootObject = A_1;
			context.IntermediateRoot = A_1;
			A_1.Title = (string)new LocExtension("Set Temperature").ProvideValue();
			BoxContainer boxContainer = new BoxContainer();
			boxContainer.Orientation = 1;
			BoxContainer boxContainer2 = new BoxContainer();
			boxContainer2.Orientation = 0;
			Control control = new Label
			{
				Text = (string)new LocExtension("Grid").ProvideValue(),
				MinSize = new Vector2(100f, 0f)
			};
			boxContainer2.XamlChildren.Add(control);
			control = new Control
			{
				MinSize = new Vector2(50f, 0f)
			};
			boxContainer2.XamlChildren.Add(control);
			OptionButton optionButton = new OptionButton();
			optionButton.Name = "GridOptions";
			control = optionButton;
			context.RobustNameScope.Register("GridOptions", control);
			optionButton.MinSize = new Vector2(100f, 0f);
			optionButton.HorizontalExpand = true;
			control = optionButton;
			boxContainer2.XamlChildren.Add(control);
			control = boxContainer2;
			boxContainer.XamlChildren.Add(control);
			BoxContainer boxContainer3 = new BoxContainer();
			boxContainer3.Orientation = 0;
			control = new Label
			{
				Text = (string)new LocExtension("TileX").ProvideValue(),
				MinSize = new Vector2(100f, 0f)
			};
			boxContainer3.XamlChildren.Add(control);
			control = new Control
			{
				MinSize = new Vector2(50f, 0f)
			};
			boxContainer3.XamlChildren.Add(control);
			SpinBox spinBox = new SpinBox();
			spinBox.Name = "TileXSpin";
			control = spinBox;
			context.RobustNameScope.Register("TileXSpin", control);
			spinBox.MinSize = new Vector2(100f, 0f);
			spinBox.HorizontalExpand = true;
			control = spinBox;
			boxContainer3.XamlChildren.Add(control);
			control = boxContainer3;
			boxContainer.XamlChildren.Add(control);
			BoxContainer boxContainer4 = new BoxContainer();
			boxContainer4.Orientation = 0;
			control = new Label
			{
				Text = (string)new LocExtension("TileY").ProvideValue(),
				MinSize = new Vector2(100f, 0f)
			};
			boxContainer4.XamlChildren.Add(control);
			control = new Control
			{
				MinSize = new Vector2(50f, 0f)
			};
			boxContainer4.XamlChildren.Add(control);
			SpinBox spinBox2 = new SpinBox();
			spinBox2.Name = "TileYSpin";
			control = spinBox2;
			context.RobustNameScope.Register("TileYSpin", control);
			spinBox2.MinSize = new Vector2(100f, 0f);
			spinBox2.HorizontalExpand = true;
			control = spinBox2;
			boxContainer4.XamlChildren.Add(control);
			control = boxContainer4;
			boxContainer.XamlChildren.Add(control);
			BoxContainer boxContainer5 = new BoxContainer();
			boxContainer5.Orientation = 0;
			control = new Label
			{
				Text = (string)new LocExtension("Temperature").ProvideValue(),
				MinSize = new Vector2(100f, 0f)
			};
			boxContainer5.XamlChildren.Add(control);
			control = new Control
			{
				MinSize = new Vector2(50f, 0f)
			};
			boxContainer5.XamlChildren.Add(control);
			SpinBox spinBox3 = new SpinBox();
			spinBox3.Name = "TemperatureSpin";
			control = spinBox3;
			context.RobustNameScope.Register("TemperatureSpin", control);
			spinBox3.MinSize = new Vector2(100f, 0f);
			spinBox3.HorizontalExpand = true;
			control = spinBox3;
			boxContainer5.XamlChildren.Add(control);
			control = boxContainer5;
			boxContainer.XamlChildren.Add(control);
			Button button = new Button();
			button.Name = "SubmitButton";
			control = button;
			context.RobustNameScope.Register("SubmitButton", control);
			button.Text = (string)new LocExtension("Set Temperature").ProvideValue();
			control = button;
			boxContainer.XamlChildren.Add(control);
			control = boxContainer;
			A_1.XamlChildren.Add(control);
			if ((control = (A_1 as Control)) != null)
			{
				context.RobustNameScope.Absorb(control.NameScope);
				control.NameScope = context.RobustNameScope;
			}
			context.RobustNameScope.Complete();
		}

		// Token: 0x06001D4E RID: 7502 RVA: 0x000AB26A File Offset: 0x000A946A
		private static void !XamlIlPopulateTrampoline(SetTemperatureWindow A_0)
		{
			SetTemperatureWindow.Populate:Content.Client.Administration.UI.Tabs.AtmosTab.SetTemperatureWindow.xaml(null, A_0);
		}

		// Token: 0x04000E99 RID: 3737
		[Nullable(new byte[]
		{
			2,
			1
		})]
		private IEnumerable<MapGridComponent> _data;
	}
}
