using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using CompiledRobustXaml;
using Content.Client.Atmos.EntitySystems;
using Content.Shared.Atmos.Prototypes;
using Robust.Client.AutoGenerated;
using Robust.Client.Console;
using Robust.Client.Player;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.CustomControls;
using Robust.Shared.Console;
using Robust.Shared.GameObjects;
using Robust.Shared.IoC;
using Robust.Shared.Localization;
using Robust.Shared.Map;
using Robust.Shared.Map.Components;
using Robust.Shared.Maths;

namespace Content.Client.Administration.UI.Tabs.AtmosTab
{
	// Token: 0x020004A3 RID: 1187
	[GenerateTypedNameReferences]
	public sealed class FillGasWindow : DefaultWindow
	{
		// Token: 0x06001D36 RID: 7478 RVA: 0x000AA3FC File Offset: 0x000A85FC
		protected override void EnteredTree()
		{
			this._gridData = from g in IoCManager.Resolve<IMapManager>().GetAllGrids()
			where (int)g.Owner != 0
			select g;
			foreach (MapGridComponent mapGridComponent in this._gridData)
			{
				LocalPlayer localPlayer = IoCManager.Resolve<IPlayerManager>().LocalPlayer;
				EntityUid? entityUid = (localPlayer != null) ? localPlayer.ControlledEntity : null;
				TransformComponent componentOrNull = EntityManagerExt.GetComponentOrNull<TransformComponent>(IoCManager.Resolve<IEntityManager>(), entityUid);
				EntityUid? entityUid2 = (componentOrNull != null) ? componentOrNull.GridUid : null;
				OptionButton gridOptions = this.GridOptions;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(1, 2);
				defaultInterpolatedStringHandler.AppendFormatted<EntityUid>(mapGridComponent.Owner);
				defaultInterpolatedStringHandler.AppendLiteral(" ");
				EntityUid? entityUid3 = entityUid2;
				EntityUid owner = mapGridComponent.Owner;
				defaultInterpolatedStringHandler.AppendFormatted((entityUid3 != null && (entityUid3 == null || entityUid3.GetValueOrDefault() == owner)) ? " (Current)" : "");
				gridOptions.AddItem(defaultInterpolatedStringHandler.ToStringAndClear(), null);
			}
			this.GridOptions.OnItemSelected += delegate(OptionButton.ItemSelectedEventArgs eventArgs)
			{
				this.GridOptions.SelectId(eventArgs.Id);
			};
			this._gasData = EntitySystem.Get<AtmosphereSystem>().Gases;
			foreach (GasPrototype gasPrototype in this._gasData)
			{
				string @string = Loc.GetString(gasPrototype.Name);
				this.GasOptions.AddItem(@string + " (" + gasPrototype.ID + ")", null);
			}
			this.GasOptions.OnItemSelected += delegate(OptionButton.ItemSelectedEventArgs eventArgs)
			{
				this.GasOptions.SelectId(eventArgs.Id);
			};
			this.SubmitButton.OnPressed += this.SubmitButtonOnOnPressed;
		}

		// Token: 0x06001D37 RID: 7479 RVA: 0x000AA60C File Offset: 0x000A880C
		[NullableContext(1)]
		private void SubmitButtonOnOnPressed(BaseButton.ButtonEventArgs obj)
		{
			if (this._gridData == null || this._gasData == null)
			{
				return;
			}
			EntityUid owner = this._gridData.ToList<MapGridComponent>()[this.GridOptions.SelectedId].Owner;
			string id = this._gasData.ToList<GasPrototype>()[this.GasOptions.SelectedId].ID;
			IConsoleHost consoleHost = IoCManager.Resolve<IClientConsoleHost>();
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(10, 3);
			defaultInterpolatedStringHandler.AppendLiteral("fillgas ");
			defaultInterpolatedStringHandler.AppendFormatted<EntityUid>(owner);
			defaultInterpolatedStringHandler.AppendLiteral(" ");
			defaultInterpolatedStringHandler.AppendFormatted(id);
			defaultInterpolatedStringHandler.AppendLiteral(" ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(this.AmountSpin.Value);
			consoleHost.ExecuteCommand(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x17000614 RID: 1556
		// (get) Token: 0x06001D38 RID: 7480 RVA: 0x000A9602 File Offset: 0x000A7802
		private OptionButton GridOptions
		{
			get
			{
				return base.FindControl<OptionButton>("GridOptions");
			}
		}

		// Token: 0x17000615 RID: 1557
		// (get) Token: 0x06001D39 RID: 7481 RVA: 0x000A9B87 File Offset: 0x000A7D87
		private OptionButton GasOptions
		{
			get
			{
				return base.FindControl<OptionButton>("GasOptions");
			}
		}

		// Token: 0x17000616 RID: 1558
		// (get) Token: 0x06001D3A RID: 7482 RVA: 0x000A9B94 File Offset: 0x000A7D94
		private SpinBox AmountSpin
		{
			get
			{
				return base.FindControl<SpinBox>("AmountSpin");
			}
		}

		// Token: 0x17000617 RID: 1559
		// (get) Token: 0x06001D3B RID: 7483 RVA: 0x00091514 File Offset: 0x0008F714
		private Button SubmitButton
		{
			get
			{
				return base.FindControl<Button>("SubmitButton");
			}
		}

		// Token: 0x06001D3C RID: 7484 RVA: 0x000AA6CD File Offset: 0x000A88CD
		public FillGasWindow()
		{
			FillGasWindow.!XamlIlPopulateTrampoline(this);
		}

		// Token: 0x06001D3F RID: 7487 RVA: 0x000AA704 File Offset: 0x000A8904
		static void xaml(IServiceProvider A_0, DefaultWindow A_1)
		{
			XamlIlContext.Context<DefaultWindow> context = new XamlIlContext.Context<DefaultWindow>(A_0, null, "resm:Content.Client.Administration.UI.Tabs.AtmosTab.FillGasWindow.xaml?assembly=Content.Client");
			context.RootObject = A_1;
			context.IntermediateRoot = A_1;
			A_1.Title = (string)new LocExtension("Fill Gas").ProvideValue();
			BoxContainer boxContainer = new BoxContainer();
			boxContainer.Orientation = 1;
			BoxContainer boxContainer2 = new BoxContainer();
			boxContainer2.Orientation = 0;
			Control control = new Label
			{
				Text = (string)new LocExtension("Grid").ProvideValue(),
				MinSize = new Vector2(100f, 0f)
			};
			boxContainer2.XamlChildren.Add(control);
			control = new Control
			{
				MinSize = new Vector2(50f, 0f)
			};
			boxContainer2.XamlChildren.Add(control);
			OptionButton optionButton = new OptionButton();
			optionButton.Name = "GridOptions";
			control = optionButton;
			context.RobustNameScope.Register("GridOptions", control);
			optionButton.MinSize = new Vector2(100f, 0f);
			optionButton.HorizontalExpand = true;
			control = optionButton;
			boxContainer2.XamlChildren.Add(control);
			control = boxContainer2;
			boxContainer.XamlChildren.Add(control);
			BoxContainer boxContainer3 = new BoxContainer();
			boxContainer3.Orientation = 0;
			control = new Label
			{
				Text = (string)new LocExtension("Gas").ProvideValue(),
				MinSize = new Vector2(100f, 0f)
			};
			boxContainer3.XamlChildren.Add(control);
			control = new Control
			{
				MinSize = new Vector2(50f, 0f)
			};
			boxContainer3.XamlChildren.Add(control);
			OptionButton optionButton2 = new OptionButton();
			optionButton2.Name = "GasOptions";
			control = optionButton2;
			context.RobustNameScope.Register("GasOptions", control);
			optionButton2.MinSize = new Vector2(100f, 0f);
			optionButton2.HorizontalExpand = true;
			control = optionButton2;
			boxContainer3.XamlChildren.Add(control);
			control = boxContainer3;
			boxContainer.XamlChildren.Add(control);
			BoxContainer boxContainer4 = new BoxContainer();
			boxContainer4.Orientation = 0;
			control = new Label
			{
				Text = (string)new LocExtension("Amount").ProvideValue(),
				MinSize = new Vector2(100f, 0f)
			};
			boxContainer4.XamlChildren.Add(control);
			control = new Control
			{
				MinSize = new Vector2(50f, 0f)
			};
			boxContainer4.XamlChildren.Add(control);
			SpinBox spinBox = new SpinBox();
			spinBox.Name = "AmountSpin";
			control = spinBox;
			context.RobustNameScope.Register("AmountSpin", control);
			spinBox.MinSize = new Vector2(100f, 0f);
			spinBox.HorizontalExpand = true;
			control = spinBox;
			boxContainer4.XamlChildren.Add(control);
			control = boxContainer4;
			boxContainer.XamlChildren.Add(control);
			Button button = new Button();
			button.Name = "SubmitButton";
			control = button;
			context.RobustNameScope.Register("SubmitButton", control);
			button.Text = (string)new LocExtension("Fill Gas").ProvideValue();
			control = button;
			boxContainer.XamlChildren.Add(control);
			control = boxContainer;
			A_1.XamlChildren.Add(control);
			if ((control = (A_1 as Control)) != null)
			{
				context.RobustNameScope.Absorb(control.NameScope);
				control.NameScope = context.RobustNameScope;
			}
			context.RobustNameScope.Complete();
		}

		// Token: 0x06001D40 RID: 7488 RVA: 0x000AAAFE File Offset: 0x000A8CFE
		private static void !XamlIlPopulateTrampoline(FillGasWindow A_0)
		{
			FillGasWindow.Populate:Content.Client.Administration.UI.Tabs.AtmosTab.FillGasWindow.xaml(null, A_0);
		}

		// Token: 0x04000E95 RID: 3733
		[Nullable(new byte[]
		{
			2,
			1
		})]
		private IEnumerable<MapGridComponent> _gridData;

		// Token: 0x04000E96 RID: 3734
		[Nullable(new byte[]
		{
			2,
			1
		})]
		private IEnumerable<GasPrototype> _gasData;
	}
}
