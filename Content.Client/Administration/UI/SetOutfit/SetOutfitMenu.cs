using System;
using System.Runtime.CompilerServices;
using CompiledRobustXaml;
using Content.Shared.Roles;
using Robust.Client.AutoGenerated;
using Robust.Client.Console;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.CustomControls;
using Robust.Shared.GameObjects;
using Robust.Shared.IoC;
using Robust.Shared.Localization;
using Robust.Shared.Prototypes;

namespace Content.Client.Administration.UI.SetOutfit
{
	// Token: 0x020004B5 RID: 1205
	[NullableContext(1)]
	[Nullable(0)]
	[GenerateTypedNameReferences]
	public sealed class SetOutfitMenu : DefaultWindow
	{
		// Token: 0x1700067E RID: 1662
		// (get) Token: 0x06001E25 RID: 7717 RVA: 0x000B11AA File Offset: 0x000AF3AA
		// (set) Token: 0x06001E26 RID: 7718 RVA: 0x000B11B2 File Offset: 0x000AF3B2
		public EntityUid? TargetEntityId { get; set; }

		// Token: 0x06001E27 RID: 7719 RVA: 0x000B11BC File Offset: 0x000AF3BC
		public SetOutfitMenu()
		{
			base.MinSize = (base.SetSize = new ValueTuple<float, float>(250f, 320f));
			IoCManager.InjectDependencies<SetOutfitMenu>(this);
			SetOutfitMenu.!XamlIlPopulateTrampoline(this);
			base.Title = Loc.GetString("set-outfit-menu-title");
			this.ConfirmButton.Text = Loc.GetString("set-outfit-menu-confirm-button");
			this.ConfirmButton.OnPressed += this.ConfirmButtonOnOnPressed;
			this.SearchBar.OnTextChanged += this.SearchBarOnOnTextChanged;
			this.OutfitList.OnItemSelected += this.OutfitListOnOnItemSelected;
			this.OutfitList.OnItemDeselected += this.OutfitListOnOnItemDeselected;
			this.PopulateList();
		}

		// Token: 0x06001E28 RID: 7720 RVA: 0x000B1288 File Offset: 0x000AF488
		private void ConfirmButtonOnOnPressed(BaseButton.ButtonEventArgs obj)
		{
			if (this.TargetEntityId == null || this._selectedOutfit == null)
			{
				return;
			}
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(11, 2);
			defaultInterpolatedStringHandler.AppendLiteral("setoutfit ");
			defaultInterpolatedStringHandler.AppendFormatted<EntityUid?>(this.TargetEntityId);
			defaultInterpolatedStringHandler.AppendLiteral(" ");
			defaultInterpolatedStringHandler.AppendFormatted(this._selectedOutfit.ID);
			string text = defaultInterpolatedStringHandler.ToStringAndClear();
			this._consoleHost.ExecuteCommand(text);
			this.Close();
		}

		// Token: 0x06001E29 RID: 7721 RVA: 0x000B1309 File Offset: 0x000AF509
		private void OutfitListOnOnItemSelected(ItemList.ItemListSelectedEventArgs obj)
		{
			this._selectedOutfit = (StartingGearPrototype)obj.ItemList.get_IndexItem(obj.ItemIndex).Metadata;
			this.ConfirmButton.Disabled = false;
		}

		// Token: 0x06001E2A RID: 7722 RVA: 0x000B1338 File Offset: 0x000AF538
		private void OutfitListOnOnItemDeselected(ItemList.ItemListDeselectedEventArgs obj)
		{
			this._selectedOutfit = null;
			this.ConfirmButton.Disabled = true;
		}

		// Token: 0x06001E2B RID: 7723 RVA: 0x000B134D File Offset: 0x000AF54D
		private void SearchBarOnOnTextChanged(LineEdit.LineEditEventArgs obj)
		{
			this.PopulateByFilter(this.SearchBar.Text);
		}

		// Token: 0x06001E2C RID: 7724 RVA: 0x000B1360 File Offset: 0x000AF560
		private void PopulateList()
		{
			foreach (StartingGearPrototype gear in this._prototypeManager.EnumeratePrototypes<StartingGearPrototype>())
			{
				this.OutfitList.Add(SetOutfitMenu.GetItem(gear, this.OutfitList));
			}
		}

		// Token: 0x06001E2D RID: 7725 RVA: 0x000B13C4 File Offset: 0x000AF5C4
		private void PopulateByFilter(string filter)
		{
			this.OutfitList.Clear();
			foreach (StartingGearPrototype startingGearPrototype in this._prototypeManager.EnumeratePrototypes<StartingGearPrototype>())
			{
				if (!string.IsNullOrEmpty(filter) && startingGearPrototype.ID.ToLowerInvariant().Contains(filter.Trim().ToLowerInvariant()))
				{
					this.OutfitList.Add(SetOutfitMenu.GetItem(startingGearPrototype, this.OutfitList));
				}
			}
		}

		// Token: 0x06001E2E RID: 7726 RVA: 0x000B1458 File Offset: 0x000AF658
		private static ItemList.Item GetItem(StartingGearPrototype gear, ItemList itemList)
		{
			return new ItemList.Item(itemList)
			{
				Metadata = gear,
				Text = gear.ID
			};
		}

		// Token: 0x1700067F RID: 1663
		// (get) Token: 0x06001E2F RID: 7727 RVA: 0x0001E1C9 File Offset: 0x0001C3C9
		[Nullable(0)]
		private LineEdit SearchBar
		{
			[NullableContext(0)]
			get
			{
				return base.FindControl<LineEdit>("SearchBar");
			}
		}

		// Token: 0x17000680 RID: 1664
		// (get) Token: 0x06001E30 RID: 7728 RVA: 0x000B1473 File Offset: 0x000AF673
		[Nullable(0)]
		private ItemList OutfitList
		{
			[NullableContext(0)]
			get
			{
				return base.FindControl<ItemList>("OutfitList");
			}
		}

		// Token: 0x17000681 RID: 1665
		// (get) Token: 0x06001E31 RID: 7729 RVA: 0x000B1480 File Offset: 0x000AF680
		[Nullable(0)]
		private Button ConfirmButton
		{
			[NullableContext(0)]
			get
			{
				return base.FindControl<Button>("ConfirmButton");
			}
		}

		// Token: 0x06001E32 RID: 7730 RVA: 0x000B1490 File Offset: 0x000AF690
		static void xaml(IServiceProvider A_0, DefaultWindow A_1)
		{
			XamlIlContext.Context<DefaultWindow> context = new XamlIlContext.Context<DefaultWindow>(A_0, null, "resm:Content.Client.Administration.UI.SetOutfit.SetOutfitMenu.xaml?assembly=Content.Client");
			context.RootObject = A_1;
			context.IntermediateRoot = A_1;
			BoxContainer boxContainer = new BoxContainer();
			boxContainer.Orientation = 0;
			boxContainer.HorizontalExpand = true;
			BoxContainer boxContainer2 = new BoxContainer();
			boxContainer2.Orientation = 1;
			boxContainer2.HorizontalExpand = true;
			boxContainer2.SizeFlagsStretchRatio = 0.45f;
			BoxContainer boxContainer3 = new BoxContainer();
			boxContainer3.Orientation = 0;
			boxContainer3.HorizontalExpand = true;
			boxContainer3.VerticalExpand = true;
			boxContainer3.SizeFlagsStretchRatio = 0.1f;
			LineEdit lineEdit = new LineEdit();
			lineEdit.Name = "SearchBar";
			Control control = lineEdit;
			context.RobustNameScope.Register("SearchBar", control);
			lineEdit.PlaceHolder = "Search";
			lineEdit.HorizontalExpand = true;
			lineEdit.SizeFlagsStretchRatio = 0.6f;
			control = lineEdit;
			boxContainer3.XamlChildren.Add(control);
			control = boxContainer3;
			boxContainer2.XamlChildren.Add(control);
			ItemList itemList = new ItemList();
			itemList.Name = "OutfitList";
			control = itemList;
			context.RobustNameScope.Register("OutfitList", control);
			itemList.SelectMode = 1;
			itemList.VerticalExpand = true;
			itemList.SizeFlagsStretchRatio = 0.9f;
			control = itemList;
			boxContainer2.XamlChildren.Add(control);
			Button button = new Button();
			button.Name = "ConfirmButton";
			control = button;
			context.RobustNameScope.Register("ConfirmButton", control);
			button.HorizontalExpand = true;
			control = button;
			boxContainer2.XamlChildren.Add(control);
			control = boxContainer2;
			boxContainer.XamlChildren.Add(control);
			control = boxContainer;
			A_1.XamlChildren.Add(control);
			if ((control = (A_1 as Control)) != null)
			{
				context.RobustNameScope.Absorb(control.NameScope);
				control.NameScope = context.RobustNameScope;
			}
			context.RobustNameScope.Complete();
		}

		// Token: 0x06001E33 RID: 7731 RVA: 0x000B16BD File Offset: 0x000AF8BD
		private static void !XamlIlPopulateTrampoline(SetOutfitMenu A_0)
		{
			SetOutfitMenu.Populate:Content.Client.Administration.UI.SetOutfit.SetOutfitMenu.xaml(null, A_0);
		}

		// Token: 0x04000EBF RID: 3775
		[Dependency]
		private readonly IPrototypeManager _prototypeManager;

		// Token: 0x04000EC0 RID: 3776
		[Dependency]
		private readonly IClientConsoleHost _consoleHost;

		// Token: 0x04000EC2 RID: 3778
		[Nullable(2)]
		private StartingGearPrototype _selectedOutfit;
	}
}
