using System;
using System.Runtime.CompilerServices;
using CompiledRobustXaml;
using Content.Client.Administration.UI.CustomControls;
using Content.Shared.Administration.Notes;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Shared.Input;

namespace Content.Client.Administration.UI.Notes
{
	// Token: 0x020004B9 RID: 1209
	[NullableContext(1)]
	[Nullable(0)]
	[GenerateTypedNameReferences]
	public sealed class AdminNotesLine : BoxContainer
	{
		// Token: 0x06001E5B RID: 7771 RVA: 0x000B1F97 File Offset: 0x000B0197
		public AdminNotesLine(SharedAdminNote note)
		{
			AdminNotesLine.!XamlIlPopulateTrampoline(this);
			this.Note = note;
			base.MouseFilter = 1;
			this.AddLabel();
		}

		// Token: 0x1700068B RID: 1675
		// (get) Token: 0x06001E5C RID: 7772 RVA: 0x000B1FB9 File Offset: 0x000B01B9
		// (set) Token: 0x06001E5D RID: 7773 RVA: 0x000B1FC1 File Offset: 0x000B01C1
		public SharedAdminNote Note { get; private set; }

		// Token: 0x1700068C RID: 1676
		// (get) Token: 0x06001E5E RID: 7774 RVA: 0x000B1FCA File Offset: 0x000B01CA
		public int Id
		{
			get
			{
				return this.Note.Id;
			}
		}

		// Token: 0x1700068D RID: 1677
		// (get) Token: 0x06001E5F RID: 7775 RVA: 0x000B1FD7 File Offset: 0x000B01D7
		public string OriginalMessage
		{
			get
			{
				return this.Note.Message;
			}
		}

		// Token: 0x1700068E RID: 1678
		// (get) Token: 0x06001E60 RID: 7776 RVA: 0x000B1FE4 File Offset: 0x000B01E4
		public string EditText
		{
			get
			{
				LineEdit edit = this._edit;
				return ((edit != null) ? edit.Text : null) ?? this.OriginalMessage;
			}
		}

		// Token: 0x140000B9 RID: 185
		// (add) Token: 0x06001E61 RID: 7777 RVA: 0x000B2004 File Offset: 0x000B0204
		// (remove) Token: 0x06001E62 RID: 7778 RVA: 0x000B203C File Offset: 0x000B023C
		[Nullable(new byte[]
		{
			2,
			1
		})]
		[Nullable(new byte[]
		{
			2,
			1
		})]
		public event Action<AdminNotesLine> OnSubmitted;

		// Token: 0x140000BA RID: 186
		// (add) Token: 0x06001E63 RID: 7779 RVA: 0x000B2074 File Offset: 0x000B0274
		// (remove) Token: 0x06001E64 RID: 7780 RVA: 0x000B20AC File Offset: 0x000B02AC
		[Nullable(new byte[]
		{
			2,
			1
		})]
		[Nullable(new byte[]
		{
			2,
			1
		})]
		public event Func<AdminNotesLine, bool> OnClicked;

		// Token: 0x06001E65 RID: 7781 RVA: 0x000B20E4 File Offset: 0x000B02E4
		private void AddLabel()
		{
			if (this._edit != null)
			{
				this._edit.OnTextEntered -= this.Submitted;
				this._edit.OnFocusExit -= this.Submitted;
				base.RemoveChild(this._edit);
				this._edit = null;
			}
			this._label = new RichTextLabel();
			this._label.SetMessage(this.Note.Message);
			base.AddChild(this._label);
			this._label.SetPositionFirst();
			this.Separator.Visible = true;
		}

		// Token: 0x06001E66 RID: 7782 RVA: 0x000B2180 File Offset: 0x000B0380
		private void AddLineEdit()
		{
			if (this._label != null)
			{
				base.RemoveChild(this._label);
				this._label = null;
			}
			this._edit = new LineEdit
			{
				Text = this.Note.Message
			};
			this._edit.OnTextEntered += this.Submitted;
			this._edit.OnFocusExit += this.Submitted;
			base.AddChild(this._edit);
			this._edit.SetPositionFirst();
			this._edit.GrabKeyboardFocus();
			this._edit.CursorPosition = this._edit.Text.Length;
			this.Separator.Visible = false;
		}

		// Token: 0x06001E67 RID: 7783 RVA: 0x000B223C File Offset: 0x000B043C
		private void Submitted(LineEdit.LineEditEventArgs args)
		{
			Action<AdminNotesLine> onSubmitted = this.OnSubmitted;
			if (onSubmitted != null)
			{
				onSubmitted(this);
			}
			this.AddLabel();
			SharedAdminNote sharedAdminNote = this.Note.<Clone>$();
			sharedAdminNote.Message = args.Text;
			SharedAdminNote note = sharedAdminNote;
			this.UpdateNote(note);
		}

		// Token: 0x06001E68 RID: 7784 RVA: 0x000B2280 File Offset: 0x000B0480
		protected override void KeyBindDown(GUIBoundKeyEventArgs args)
		{
			base.KeyBindDown(args);
			if (args.Function != EngineKeyFunctions.UIRightClick && args.Function != EngineKeyFunctions.UIClick)
			{
				return;
			}
			Func<AdminNotesLine, bool> onClicked = this.OnClicked;
			if (onClicked != null && onClicked(this))
			{
				args.Handle();
			}
		}

		// Token: 0x06001E69 RID: 7785 RVA: 0x000B22D4 File Offset: 0x000B04D4
		public void UpdateNote(SharedAdminNote note)
		{
			this.Note = note;
			RichTextLabel label = this._label;
			if (label != null)
			{
				label.SetMessage(note.Message);
			}
			if (this._edit != null && this._edit.Text != note.Message)
			{
				this._edit.Text = note.Message;
			}
		}

		// Token: 0x06001E6A RID: 7786 RVA: 0x000B2330 File Offset: 0x000B0530
		public void SetEditable(bool editable)
		{
			if (editable)
			{
				this.AddLineEdit();
				return;
			}
			this.AddLabel();
		}

		// Token: 0x06001E6B RID: 7787 RVA: 0x000B2344 File Offset: 0x000B0544
		protected override void Dispose(bool disposing)
		{
			base.Dispose(disposing);
			if (!disposing)
			{
				return;
			}
			if (this._edit != null)
			{
				this._edit.OnTextEntered -= this.Submitted;
				this._edit.OnFocusExit -= this.Submitted;
			}
			this.OnSubmitted = null;
			this.OnClicked = null;
		}

		// Token: 0x1700068F RID: 1679
		// (get) Token: 0x06001E6C RID: 7788 RVA: 0x00057F4A File Offset: 0x0005614A
		[Nullable(0)]
		private HSeparator Separator
		{
			[NullableContext(0)]
			get
			{
				return base.FindControl<HSeparator>("Separator");
			}
		}

		// Token: 0x06001E6D RID: 7789 RVA: 0x000B23A0 File Offset: 0x000B05A0
		static void xaml(IServiceProvider A_0, BoxContainer A_1)
		{
			XamlIlContext.Context<BoxContainer> context = new XamlIlContext.Context<BoxContainer>(A_0, null, "resm:Content.Client.Administration.UI.Notes.AdminNotesLine.xaml?assembly=Content.Client");
			context.RootObject = A_1;
			context.IntermediateRoot = A_1;
			A_1.Orientation = 1;
			HSeparator hseparator = new HSeparator();
			hseparator.Name = "Separator";
			Control control = hseparator;
			context.RobustNameScope.Register("Separator", control);
			control = hseparator;
			A_1.XamlChildren.Add(control);
			if ((control = (A_1 as Control)) != null)
			{
				context.RobustNameScope.Absorb(control.NameScope);
				control.NameScope = context.RobustNameScope;
			}
			context.RobustNameScope.Complete();
		}

		// Token: 0x06001E6E RID: 7790 RVA: 0x000B2462 File Offset: 0x000B0662
		private static void !XamlIlPopulateTrampoline(AdminNotesLine A_0)
		{
			AdminNotesLine.Populate:Content.Client.Administration.UI.Notes.AdminNotesLine.xaml(null, A_0);
		}

		// Token: 0x04000ECF RID: 3791
		[Nullable(2)]
		private RichTextLabel _label;

		// Token: 0x04000ED0 RID: 3792
		[Nullable(2)]
		private LineEdit _edit;
	}
}
