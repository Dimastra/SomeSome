using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using CompiledRobustXaml;
using Content.Client.UserInterface.Controls;
using Content.Shared.Cargo;
using Content.Shared.Cargo.Prototypes;
using Robust.Client.AutoGenerated;
using Robust.Client.GameObjects;
using Robust.Client.Graphics;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Shared.Localization;
using Robust.Shared.Maths;
using Robust.Shared.Prototypes;
using Robust.Shared.Timing;

namespace Content.Client.Cargo.UI
{
	// Token: 0x02000409 RID: 1033
	[GenerateTypedNameReferences]
	public sealed class CargoShuttleMenu : FancyWindow
	{
		// Token: 0x0600196F RID: 6511 RVA: 0x00092030 File Offset: 0x00090230
		[NullableContext(1)]
		public CargoShuttleMenu(IGameTiming timing, IPrototypeManager protoManager, SpriteSystem spriteSystem)
		{
			CargoShuttleMenu.!XamlIlPopulateTrampoline(this);
			this._timing = timing;
			this._protoManager = protoManager;
			this._spriteSystem = spriteSystem;
			this.ShuttleCallButton.OnPressed += this.OnCallPressed;
			this.ShuttleRecallButton.OnPressed += this.OnRecallPressed;
			base.Title = Loc.GetString("cargo-shuttle-console-menu-title");
		}

		// Token: 0x06001970 RID: 6512 RVA: 0x0009209C File Offset: 0x0009029C
		[NullableContext(1)]
		public void SetAccountName(string name)
		{
			this.AccountNameLabel.Text = name;
		}

		// Token: 0x06001971 RID: 6513 RVA: 0x000920AA File Offset: 0x000902AA
		[NullableContext(1)]
		public void SetShuttleName(string name)
		{
			this.ShuttleNameLabel.Text = name;
		}

		// Token: 0x06001972 RID: 6514 RVA: 0x000920B8 File Offset: 0x000902B8
		public void SetShuttleETA(TimeSpan? eta)
		{
			this._shuttleEta = eta;
			if (eta == null)
			{
				this.ShuttleCallButton.Visible = false;
				this.ShuttleRecallButton.Visible = true;
				return;
			}
			this.ShuttleRecallButton.Visible = false;
			this.ShuttleCallButton.Visible = true;
			this.ShuttleCallButton.Disabled = true;
		}

		// Token: 0x06001973 RID: 6515 RVA: 0x00092112 File Offset: 0x00090312
		[NullableContext(1)]
		private void OnRecallPressed(BaseButton.ButtonEventArgs obj)
		{
			Action shuttleRecallRequested = this.ShuttleRecallRequested;
			if (shuttleRecallRequested == null)
			{
				return;
			}
			shuttleRecallRequested();
		}

		// Token: 0x06001974 RID: 6516 RVA: 0x00092124 File Offset: 0x00090324
		[NullableContext(1)]
		private void OnCallPressed(BaseButton.ButtonEventArgs obj)
		{
			Action shuttleCallRequested = this.ShuttleCallRequested;
			if (shuttleCallRequested == null)
			{
				return;
			}
			shuttleCallRequested();
		}

		// Token: 0x06001975 RID: 6517 RVA: 0x00092138 File Offset: 0x00090338
		[NullableContext(1)]
		public void SetOrders(List<CargoOrderData> orders)
		{
			this.Orders.DisposeAllChildren();
			foreach (CargoOrderData cargoOrderData in orders)
			{
				CargoProductPrototype cargoProductPrototype = this._protoManager.Index<CargoProductPrototype>(cargoOrderData.ProductId);
				string name = cargoProductPrototype.Name;
				CargoOrderRow cargoOrderRow = new CargoOrderRow
				{
					Order = cargoOrderData,
					Icon = 
					{
						Texture = this._spriteSystem.Frame0(cargoProductPrototype.Icon)
					},
					ProductName = 
					{
						Text = Loc.GetString("cargo-console-menu-populate-orders-cargo-order-row-product-name-text", new ValueTuple<string, object>[]
						{
							new ValueTuple<string, object>("productName", name),
							new ValueTuple<string, object>("orderAmount", cargoOrderData.Amount),
							new ValueTuple<string, object>("orderRequester", cargoOrderData.Requester)
						})
					},
					Description = 
					{
						Text = Loc.GetString("cargo-console-menu-order-reason-description", new ValueTuple<string, object>[]
						{
							new ValueTuple<string, object>("reason", cargoOrderData.Reason)
						})
					}
				};
				cargoOrderRow.Approve.Visible = false;
				cargoOrderRow.Cancel.Visible = false;
				this.Orders.AddChild(cargoOrderRow);
			}
		}

		// Token: 0x06001976 RID: 6518 RVA: 0x000922A0 File Offset: 0x000904A0
		public void SetCanRecall(bool canRecall)
		{
			this.ShuttleRecallButton.Disabled = !canRecall;
		}

		// Token: 0x06001977 RID: 6519 RVA: 0x000922B4 File Offset: 0x000904B4
		[NullableContext(1)]
		protected override void Draw(DrawingHandleScreen handle)
		{
			base.Draw(handle);
			TimeSpan? timeSpan = this._shuttleEta - this._timing.CurTime;
			if (timeSpan == null || timeSpan <= TimeSpan.Zero)
			{
				this.ShuttleStatusLabel.Text = "Available";
				this.ShuttleCallButton.Disabled = false;
				return;
			}
			Label shuttleStatusLabel = this.ShuttleStatusLabel;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(14, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Available in: ");
			defaultInterpolatedStringHandler.AppendFormatted<double>(timeSpan.Value.TotalSeconds, "0.0");
			shuttleStatusLabel.Text = defaultInterpolatedStringHandler.ToStringAndClear();
		}

		// Token: 0x17000545 RID: 1349
		// (get) Token: 0x06001978 RID: 6520 RVA: 0x00090D04 File Offset: 0x0008EF04
		private Label AccountNameLabel
		{
			get
			{
				return base.FindControl<Label>("AccountNameLabel");
			}
		}

		// Token: 0x17000546 RID: 1350
		// (get) Token: 0x06001979 RID: 6521 RVA: 0x0009238E File Offset: 0x0009058E
		private Label ShuttleNameLabel
		{
			get
			{
				return base.FindControl<Label>("ShuttleNameLabel");
			}
		}

		// Token: 0x17000547 RID: 1351
		// (get) Token: 0x0600197A RID: 6522 RVA: 0x0009239B File Offset: 0x0009059B
		private Label ShuttleStatusLabel
		{
			get
			{
				return base.FindControl<Label>("ShuttleStatusLabel");
			}
		}

		// Token: 0x17000548 RID: 1352
		// (get) Token: 0x0600197B RID: 6523 RVA: 0x000923A8 File Offset: 0x000905A8
		private Button ShuttleCallButton
		{
			get
			{
				return base.FindControl<Button>("ShuttleCallButton");
			}
		}

		// Token: 0x17000549 RID: 1353
		// (get) Token: 0x0600197C RID: 6524 RVA: 0x000923B5 File Offset: 0x000905B5
		private Button ShuttleRecallButton
		{
			get
			{
				return base.FindControl<Button>("ShuttleRecallButton");
			}
		}

		// Token: 0x1700054A RID: 1354
		// (get) Token: 0x0600197D RID: 6525 RVA: 0x00090D52 File Offset: 0x0008EF52
		private BoxContainer Orders
		{
			get
			{
				return base.FindControl<BoxContainer>("Orders");
			}
		}

		// Token: 0x0600197E RID: 6526 RVA: 0x000923C4 File Offset: 0x000905C4
		static void xaml(IServiceProvider A_0, FancyWindow A_1)
		{
			XamlIlContext.Context<FancyWindow> context = new XamlIlContext.Context<FancyWindow>(A_0, null, "resm:Content.Client.Cargo.UI.CargoShuttleMenu.xaml?assembly=Content.Client");
			context.RootObject = A_1;
			context.IntermediateRoot = A_1;
			A_1.SetSize = new Vector2(600f, 600f);
			A_1.MinSize = new Vector2(600f, 600f);
			BoxContainer boxContainer = new BoxContainer();
			boxContainer.Orientation = 1;
			BoxContainer boxContainer2 = new BoxContainer();
			boxContainer2.Orientation = 0;
			Label label = new Label();
			label.Text = (string)new LocExtension("cargo-console-menu-account-name-label").ProvideValue();
			string item = "LabelKeyText";
			label.StyleClasses.Add(item);
			Control control = label;
			boxContainer2.XamlChildren.Add(control);
			Label label2 = new Label();
			label2.Name = "AccountNameLabel";
			control = label2;
			context.RobustNameScope.Register("AccountNameLabel", control);
			label2.Text = (string)new LocExtension("cargo-console-menu-account-name-none-text").ProvideValue();
			control = label2;
			boxContainer2.XamlChildren.Add(control);
			control = boxContainer2;
			boxContainer.XamlChildren.Add(control);
			BoxContainer boxContainer3 = new BoxContainer();
			boxContainer3.Orientation = 0;
			Label label3 = new Label();
			label3.Text = (string)new LocExtension("cargo-console-menu-shuttle-name-label").ProvideValue();
			item = "LabelKeyText";
			label3.StyleClasses.Add(item);
			control = label3;
			boxContainer3.XamlChildren.Add(control);
			Label label4 = new Label();
			label4.Name = "ShuttleNameLabel";
			control = label4;
			context.RobustNameScope.Register("ShuttleNameLabel", control);
			label4.Text = (string)new LocExtension("cargo-console-menu-shuttle-name-none-text").ProvideValue();
			control = label4;
			boxContainer3.XamlChildren.Add(control);
			control = boxContainer3;
			boxContainer.XamlChildren.Add(control);
			BoxContainer boxContainer4 = new BoxContainer();
			boxContainer4.Orientation = 0;
			Label label5 = new Label();
			label5.Text = (string)new LocExtension("cargo-console-menu-shuttle-status-label").ProvideValue();
			item = "LabelKeyText";
			label5.StyleClasses.Add(item);
			control = label5;
			boxContainer4.XamlChildren.Add(control);
			Label label6 = new Label();
			label6.Name = "ShuttleStatusLabel";
			control = label6;
			context.RobustNameScope.Register("ShuttleStatusLabel", control);
			label6.Text = (string)new LocExtension("cargo-console-menu-shuttle-status-away-text").ProvideValue();
			control = label6;
			boxContainer4.XamlChildren.Add(control);
			control = boxContainer4;
			boxContainer.XamlChildren.Add(control);
			Button button = new Button();
			button.Name = "ShuttleCallButton";
			control = button;
			context.RobustNameScope.Register("ShuttleCallButton", control);
			button.Text = "Call Shuttle";
			control = button;
			boxContainer.XamlChildren.Add(control);
			Button button2 = new Button();
			button2.Name = "ShuttleRecallButton";
			control = button2;
			context.RobustNameScope.Register("ShuttleRecallButton", control);
			button2.Text = "Recall Shuttle";
			button2.ToolTip = "Needs to be out of range to recall.";
			button2.Visible = false;
			control = button2;
			boxContainer.XamlChildren.Add(control);
			control = new Label
			{
				Text = (string)new LocExtension("cargo-console-menu-orders-label").ProvideValue()
			};
			boxContainer.XamlChildren.Add(control);
			PanelContainer panelContainer = new PanelContainer();
			panelContainer.VerticalExpand = true;
			panelContainer.SizeFlagsStretchRatio = 6f;
			panelContainer.PanelOverride = new StyleBoxFlat
			{
				BackgroundColor = Color.FromXaml("#000000")
			};
			ScrollContainer scrollContainer = new ScrollContainer();
			scrollContainer.VerticalExpand = true;
			BoxContainer boxContainer5 = new BoxContainer();
			boxContainer5.Name = "Orders";
			control = boxContainer5;
			context.RobustNameScope.Register("Orders", control);
			boxContainer5.Orientation = 1;
			item = "transparentItemList";
			boxContainer5.StyleClasses.Add(item);
			boxContainer5.VerticalExpand = true;
			control = boxContainer5;
			scrollContainer.XamlChildren.Add(control);
			control = scrollContainer;
			panelContainer.XamlChildren.Add(control);
			control = panelContainer;
			boxContainer.XamlChildren.Add(control);
			control = new TextureButton
			{
				VerticalExpand = true
			};
			boxContainer.XamlChildren.Add(control);
			control = boxContainer;
			A_1.XamlChildren.Add(control);
			if ((control = (A_1 as Control)) != null)
			{
				context.RobustNameScope.Absorb(control.NameScope);
				control.NameScope = context.RobustNameScope;
			}
			context.RobustNameScope.Complete();
		}

		// Token: 0x0600197F RID: 6527 RVA: 0x000928C1 File Offset: 0x00090AC1
		private static void !XamlIlPopulateTrampoline(CargoShuttleMenu A_0)
		{
			CargoShuttleMenu.Populate:Content.Client.Cargo.UI.CargoShuttleMenu.xaml(null, A_0);
		}

		// Token: 0x04000CE5 RID: 3301
		[Nullable(1)]
		private readonly IGameTiming _timing;

		// Token: 0x04000CE6 RID: 3302
		[Nullable(1)]
		private readonly IPrototypeManager _protoManager;

		// Token: 0x04000CE7 RID: 3303
		[Nullable(1)]
		private readonly SpriteSystem _spriteSystem;

		// Token: 0x04000CE8 RID: 3304
		[Nullable(2)]
		public Action ShuttleCallRequested;

		// Token: 0x04000CE9 RID: 3305
		[Nullable(2)]
		public Action ShuttleRecallRequested;

		// Token: 0x04000CEA RID: 3306
		private TimeSpan? _shuttleEta;
	}
}
