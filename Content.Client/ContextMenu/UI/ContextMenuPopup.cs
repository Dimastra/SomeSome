using System;
using System.Runtime.CompilerServices;
using CompiledRobustXaml;
using Robust.Client.AutoGenerated;
using Robust.Client.Graphics;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Shared.Maths;

namespace Content.Client.ContextMenu.UI
{
	// Token: 0x0200037E RID: 894
	[GenerateTypedNameReferences]
	public sealed class ContextMenuPopup : Popup
	{
		// Token: 0x060015F8 RID: 5624 RVA: 0x00081C44 File Offset: 0x0007FE44
		[NullableContext(1)]
		public ContextMenuPopup(ContextMenuUIController uiController, [Nullable(2)] ContextMenuElement parentElement)
		{
			ContextMenuPopup.!XamlIlPopulateTrampoline(this);
			this.MenuPanel.SetOnlyStyleClass("contextMenuPopup");
			this._uiController = uiController;
			this.ParentElement = parentElement;
			this.Scroll.AddChild(this.MenuBody);
			this.MenuPanel.ForceRunStyleUpdate();
			StyleBox styleBox;
			this.MenuPanel.TryGetStyleProperty<StyleBox>("panel", ref styleBox);
			Vector2 vector = ((styleBox != null) ? styleBox.MinimumSize : Vector2.Zero) / this.UIScale;
			this.MenuPanel.MaxHeight = 360f + vector.Y;
			base.UserInterfaceManager.ModalRoot.AddChild(this);
			this.MenuBody.OnChildRemoved += delegate(Control ctrl)
			{
				this._uiController.OnRemoveElement(this, ctrl);
			};
			this.MenuBody.VSeparationOverride = new int?(0);
			this.MenuBody.HSeparationOverride = new int?(0);
			if (this.ParentElement != null)
			{
				this.ParentElement.SubMenu = this;
			}
			base.OnPopupHide += delegate()
			{
				if (this.ParentElement != null)
				{
					this._uiController.CloseSubMenus(this.ParentElement.ParentMenu);
				}
			};
		}

		// Token: 0x060015F9 RID: 5625 RVA: 0x00081D58 File Offset: 0x0007FF58
		protected override void Dispose(bool disposing)
		{
			this.MenuBody.OnChildRemoved -= delegate(Control ctrl)
			{
				this._uiController.OnRemoveElement(this, ctrl);
			};
			this.ParentElement = null;
			base.Dispose(disposing);
		}

		// Token: 0x17000470 RID: 1136
		// (get) Token: 0x060015FA RID: 5626 RVA: 0x00081D7F File Offset: 0x0007FF7F
		private PanelContainer MenuPanel
		{
			get
			{
				return base.FindControl<PanelContainer>("MenuPanel");
			}
		}

		// Token: 0x17000471 RID: 1137
		// (get) Token: 0x060015FB RID: 5627 RVA: 0x00070DD7 File Offset: 0x0006EFD7
		private ScrollContainer Scroll
		{
			get
			{
				return base.FindControl<ScrollContainer>("Scroll");
			}
		}

		// Token: 0x060015FF RID: 5631 RVA: 0x00081DBC File Offset: 0x0007FFBC
		static void xaml(IServiceProvider A_0, Popup A_1)
		{
			XamlIlContext.Context<Popup> context = new XamlIlContext.Context<Popup>(A_0, null, "resm:Content.Client.ContextMenu.UI.ContextMenuPopup.xaml?assembly=Content.Client");
			context.RootObject = A_1;
			context.IntermediateRoot = A_1;
			PanelContainer panelContainer = new PanelContainer();
			panelContainer.Name = "MenuPanel";
			Control control = panelContainer;
			context.RobustNameScope.Register("MenuPanel", control);
			ScrollContainer scrollContainer = new ScrollContainer();
			scrollContainer.Name = "Scroll";
			control = scrollContainer;
			context.RobustNameScope.Register("Scroll", control);
			scrollContainer.VerticalExpand = true;
			scrollContainer.HScrollEnabled = false;
			scrollContainer.ReturnMeasure = true;
			scrollContainer.ReserveScrollbarSpace = false;
			control = scrollContainer;
			panelContainer.XamlChildren.Add(control);
			control = panelContainer;
			A_1.XamlChildren.Add(control);
			if ((control = (A_1 as Control)) != null)
			{
				context.RobustNameScope.Absorb(control.NameScope);
				control.NameScope = context.RobustNameScope;
			}
			context.RobustNameScope.Complete();
		}

		// Token: 0x06001600 RID: 5632 RVA: 0x00081EDE File Offset: 0x000800DE
		private static void !XamlIlPopulateTrampoline(ContextMenuPopup A_0)
		{
			ContextMenuPopup.Populate:Content.Client.ContextMenu.UI.ContextMenuPopup.xaml(null, A_0);
		}

		// Token: 0x04000B7B RID: 2939
		[Nullable(1)]
		public const string StyleClassContextMenuPopup = "contextMenuPopup";

		// Token: 0x04000B7C RID: 2940
		public const int MaxItemsBeforeScroll = 10;

		// Token: 0x04000B7D RID: 2941
		[Nullable(2)]
		public ContextMenuElement ParentElement;

		// Token: 0x04000B7E RID: 2942
		[Nullable(1)]
		public GridContainer MenuBody = new GridContainer();

		// Token: 0x04000B7F RID: 2943
		[Nullable(1)]
		private ContextMenuUIController _uiController;
	}
}
